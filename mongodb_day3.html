<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MongoDB Mastering Course - Day 3</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/reveal.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/theme/white.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/plugin/highlight/monokai.min.css">

    <style>
        .reveal {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .reveal h1, .reveal h2, .reveal h3, .reveal h4 {
            color: #2C5F41;
            text-transform: none;
        }

        .reveal h1 {
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .reveal .title-slide {
            background: linear-gradient(135deg, #2C5F41 0%, #4A8B3B 100%);
            color: white !important;
            padding: 2em;
            border-radius: 15px;
        }

        .reveal .title-slide h1, 
        .reveal .title-slide h2 {
            color: white !important;
        }

        .reveal .section-title {
            background: linear-gradient(135deg, #4A8B3B 0%, #6BAF47 100%);
            color: white !important;
            padding: 1.5em;
            border-radius: 10px;
            margin-bottom: 0.5em;
        }

        .reveal .section-title h2 {
            color: white !important;
            margin: 0;
        }

        .reveal .duration {
            background: #2C5F41;
            color: white;
            padding: 0.5em 1em;
            border-radius: 20px;
            font-size: 0.8em;
            display: inline-block;
            margin: 0.5em 0;
        }

        .reveal .highlight-box {
            background: linear-gradient(120deg, #a8e6cf 0%, #dcedc1 100%);
            padding: 1em;
            border-radius: 8px;
            border-left: 4px solid #4A8B3B;
            margin: 1em 0;
        }

        .reveal .info-box {
            background: #e8f4f8;
            border: 2px solid #4A8B3B;
            border-radius: 8px;
            padding: 1em;
            margin: 1em 0;
        }

        .reveal .warning-box {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 1em;
            margin: 1em 0;
        }

        .reveal .lab-slide {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            border: 3px solid #ff8a80;
            border-radius: 15px;
            padding: 1em;
        }

        .reveal .lab-slide h3 {
            color: #d32f2f !important;
            margin-top: 0;
        }

        .reveal .objectives {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 1em;
            margin: 1em 0;
        }

        .reveal table {
            margin: auto;
            border-collapse: collapse;
            border-spacing: 0;
            font-size: 0.8em;
        }

        .reveal table th {
            background: #4A8B3B;
            color: white;
            font-weight: bold;
        }

        .reveal table th,
        .reveal table td {
            text-align: left;
            padding: 0.5em;
            border-bottom: 1px solid #ddd;
        }

        .reveal table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .reveal pre code {
            max-height: 500px;
            font-size: 0.6em;
            line-height: 1.2;
        }

        .reveal .slides section .fragment {
            opacity: 0.3;
        }

        .reveal .slides section .fragment.visible {
            opacity: 1;
        }

        .reveal .progress {
            background: rgba(44, 95, 65, 0.2);
        }

        .reveal .progress span {
            background: #4A8B3B;
        }

        .reveal .controls {
            color: #4A8B3B;
        }

        .reveal .slide-number {
            background-color: #2C5F41;
            color: white;
        }

        .reveal .two-column {
            display: flex;
            justify-content: space-between;
        }

        .reveal .two-column > div {
            flex: 1;
            margin: 0 0.5em;
        }

        .reveal .mongodb-logo {
            color: #4A8B3B;
            font-weight: bold;
            font-size: 1.2em;
        }

        .reveal .small-text {
            font-size: 0.7em;
        }

        .reveal .code-title {
            background: #2C5F41;
            color: white;
            padding: 0.5em;
            margin: 0;
            border-radius: 5px 5px 0 0;
            font-size: 0.8em;
        }

        .reveal .agenda-item {
            padding: 0.5em;
            margin: 0.3em 0;
            background: #f8f9fa;
            border-left: 4px solid #4A8B3B;
            border-radius: 0 5px 5px 0;
        }

        .reveal .exercise-box {
            background: #fff8e1;
            border: 2px solid #ff9800;
            border-radius: 8px;
            padding: 1em;
            margin: 1em 0;
        }
    </style>
</head>

<body>
    <div class="reveal">
        <div class="slides">
            <!-- Title Slide -->
            <section class="title-slide">
                <h1>MongoDB Mastering Course</h1>
                <h2>Day 3: Advanced Operations & Performance</h2>
                <p style="margin-top: 2em; font-size: 1.2em;">
                    <span class="mongodb-logo">üçÉ MongoDB</span> in Docker Environment
                </p>
                <p style="margin-top: 1em; opacity: 0.9;">
                    Advanced Querying, Performance & Best Practices
                </p>
            </section>

            <!-- Course Overview -->
            <section>
                <div class="section-title">
                    <h2>Session Overview</h2>
                </div>
                
                <div class="objectives">
                    <h4>Learning Objectives</h4>
                    <ul>
                        <li class="fragment">Master advanced querying techniques</li>
                        <li class="fragment">Implement effective indexing strategies</li>
                        <li class="fragment">Understand aggregation framework</li>
                        <li class="fragment">Optimize performance and troubleshoot issues</li>
                        <li class="fragment">Explore data modeling best practices</li>
                    </ul>
                </div>

                <div class="agenda-item fragment">
                    <strong>1. Advanced Querying Techniques</strong>
                </div>
                <div class="agenda-item fragment">
                    <strong>2. Indexing Strategies</strong>
                </div>
                <div class="agenda-item fragment">
                    <strong>3. Aggregation Framework Deep Dive</strong>
                </div>
                <div class="agenda-item fragment">
                    <strong>4. Performance Optimization</strong>
                </div>
                <div class="agenda-item fragment">
                    <strong>5. Data Modeling Best Practices</strong>
                </div>
                <div class="agenda-item fragment">
                    <strong>6. Security & Administration</strong>
                </div>
                <div class="agenda-item fragment">
                    <strong>7. Practical Exercises</strong>
                </div>
            </section>

            <!-- Section 1: Advanced Querying -->
            <section>
                <section class="section-title">
                    <h2>1. Advanced Querying Techniques</h2>
                </section>

                <section>
                    <h3>Complex Query Operators</h3>
                    <p class="code-title">Array Operations</p>
                    <pre><code class="language-javascript">
// Find documents with specific array elements
db.products.find({ tags: { $in: ["electronics", "mobile"] } })

// Array size queries
db.products.find({ tags: { $size: 3 } })

// All elements match condition
db.products.find({ ratings: { $all: [4, 5] } })

// Element match for array of objects
db.users.find({ 
  "addresses": { 
    $elemMatch: { 
      "city": "New York", 
      "type": "home" 
    } 
  } 
})
                    </code></pre>
                </section>

                <section>
                    <h3>Text Search Capabilities</h3>
                    <p class="code-title">Full-Text Search</p>
                    <pre><code class="language-javascript">
// Create text index
db.articles.createIndex({ title: "text", content: "text" })

// Basic text search
db.articles.find({ $text: { $search: "mongodb database" } })

// Text search with scores
db.articles.find(
  { $text: { $search: "mongodb" } },
  { score: { $meta: "textScore" } }
).sort({ score: { $meta: "textScore" } })

// Advanced text search options
db.articles.find({
  $text: {
    $search: "\"exact phrase\" advanced",
    $language: "english",
    $caseSensitive: false
  }
})
                    </code></pre>
                </section>

                <section>
                    <h3>Geospatial Queries</h3>
                    <div class="two-column">
                        <div>
                            <p class="code-title">Near Queries</p>
                            <pre><code class="language-javascript small-text">
// Create 2dsphere index
db.locations.createIndex({ 
  coordinates: "2dsphere" 
})

// Find nearby locations
db.locations.find({
  coordinates: {
    $near: {
      $geometry: { 
        type: "Point", 
        coordinates: [-73.9857, 40.7484] 
      },
      $maxDistance: 1000
    }
  }
})
                            </code></pre>
                        </div>
                        <div>
                            <p class="code-title">Polygon Queries</p>
                            <pre><code class="language-javascript small-text">
// Find within polygon
db.locations.find({
  coordinates: {
    $geoWithin: {
      $geometry: {
        type: "Polygon",
        coordinates: [[
          [-74, 40.5], 
          [-74, 41], 
          [-73, 41], 
          [-73, 40.5], 
          [-74, 40.5]
        ]]
      }
    }
  }
})
                            </code></pre>
                        </div>
                    </div>
                </section>

                <section>
                    <h3>Regular Expression Patterns</h3>
                    <p class="code-title">Advanced Pattern Matching</p>
                    <pre><code class="language-javascript">
// Case-insensitive pattern matching
db.users.find({ name: { $regex: /^john/i } })

// Complex email validation
db.users.find({
  email: { 
    $regex: /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/ 
  }
})

// Product code format validation
db.products.find({
  sku: { $regex: /^[A-Z]{2}\d{4}$/ }  // 2 letters + 4 digits
})

// Using $regex with options
db.articles.find({
  title: {
    $regex: "mongodb",
    $options: "im"  // case-insensitive and multiline
  }
})
                    </code></pre>
                </section>
            </section>

            <!-- Section 2: Indexing Strategies -->
            <section>
                <section class="section-title">
                    <h2>2. Indexing Strategies</h2>
                </section>

                <section>
                    <h3>Index Types and Performance</h3>
                    <div class="two-column">
                        <div>
                            <p class="code-title">Single Field Indexes</p>
                            <pre><code class="language-javascript small-text">
// Basic index
db.users.createIndex({ email: 1 })

// Sparse index (only non-null values)
db.users.createIndex(
  { phone: 1 }, 
  { sparse: true }
)

// Unique index
db.users.createIndex(
  { username: 1 }, 
  { unique: true }
)

// TTL index (time-to-live)
db.sessions.createIndex(
  { createdAt: 1 }, 
  { expireAfterSeconds: 3600 }
)
                            </code></pre>
                        </div>
                        <div>
                            <p class="code-title">Compound Indexes</p>
                            <pre><code class="language-javascript small-text">
// Order matters for compound indexes
db.orders.createIndex({ 
  userId: 1, 
  status: 1, 
  createdAt: -1 
})

// Index prefix rule supports:
// { userId: 1 }
// { userId: 1, status: 1 }
// { userId: 1, status: 1, createdAt: -1 }

// Multikey compound index
db.products.createIndex({
  category: 1,
  tags: 1,    // Array field
  price: -1
})
                            </code></pre>
                        </div>
                    </div>
                </section>

                <section>
                    <h3>Index Performance Analysis</h3>
                    <p class="code-title">Query Execution Analysis</p>
                    <pre><code class="language-javascript">
// Explain query execution
db.users.find({ email: "john@example.com" }).explain("executionStats")

// Key metrics to examine:
// - executionTimeMillis
// - totalDocsExamined vs totalDocsReturned
// - indexesUsed
// - stage: "IXSCAN" (good) vs "COLLSCAN" (bad)

// Index usage statistics
db.users.aggregate([{ $indexStats: {} }])

// Find unused indexes
db.runCommand({ planCacheClear: "users" })

// Monitor index efficiency
db.users.find({ email: "test@example.com" }).explain("allPlansExecution")
                    </code></pre>
                </section>

                <section>
                    <h3>ESR Rule (Equality, Sort, Range)</h3>
                    <div class="highlight-box">
                        <h4>Optimal Index Ordering Strategy</h4>
                        <p>Design compound indexes following the ESR rule for maximum efficiency</p>
                    </div>
                    <p class="code-title">ESR Rule Example</p>
                    <pre><code class="language-javascript">
// Query: Find active users, sort by creation date, filter by age range
db.users.find({ 
  status: "active",                    // Equality
  age: { $gte: 25, $lte: 65 }         // Range
}).sort({ createdAt: -1 })             // Sort

// Optimal index follows ESR rule:
db.users.createIndex({ 
  status: 1,      // Equality first
  createdAt: -1,  // Sort second  
  age: 1          // Range last
})
                    </code></pre>
                    <div class="fragment warning-box">
                        <p><strong>‚ö†Ô∏è Important:</strong> Violating ESR rule can lead to in-memory sorts and poor performance</p>
                    </div>
                </section>

                <section>
                    <h3>Specialized Index Types</h3>
                    <div class="two-column">
                        <div>
                            <div class="info-box">
                                <h4>üîç Text Indexes</h4>
                                <pre><code class="language-javascript small-text">
// Compound text index with weights
db.products.createIndex({
  title: "text",
  description: "text",
  tags: "text"
}, {
  weights: {
    title: 10,
    description: 5,
    tags: 1
  },
  name: "product_text_search"
})
                                </code></pre>
                            </div>
                        </div>
                        <div>
                            <div class="info-box">
                                <h4>üåç Geospatial Indexes</h4>
                                <pre><code class="language-javascript small-text">
// 2dsphere for GeoJSON
db.stores.createIndex({
  location: "2dsphere"
})

// Compound geospatial index
db.stores.createIndex({
  location: "2dsphere",
  category: 1,
  rating: -1
})
                                </code></pre>
                            </div>
                        </div>
                    </div>
                </section>
            </section>

            <!-- Section 3: Aggregation Framework -->
            <section>
                <section class="section-title">
                    <h2>3. Aggregation Framework Deep Dive</h2>
                </section>

                <section>
                    <h3>Complex Aggregation Pipeline</h3>
                    <p class="code-title">Sales Analytics Pipeline</p>
                    <pre><code class="language-javascript">
db.sales.aggregate([
  // Stage 1: Match documents
  { $match: { 
    date: { $gte: ISODate("2024-01-01") },
    status: "completed"
  }},
  
  // Stage 2: Add computed fields
  { $addFields: {
    month: { $month: "$date" },
    totalValue: { $multiply: ["$quantity", "$price"] }
  }},
  
  // Stage 3: Group and calculate
  { $group: {
    _id: { month: "$month", category: "$category" },
    totalSales: { $sum: "$totalValue" },
    avgOrderValue: { $avg: "$totalValue" },
    orderCount: { $sum: 1 },
    topProduct: { $first: "$product" }
  }},
  
  // Stage 4: Sort results
  { $sort: { totalSales: -1 } },
  
  // Stage 5: Limit results
  { $limit: 10 }
])
                    </code></pre>
                </section>

                <section>
                    <h3>Advanced Pipeline Operators</h3>
                    <p class="code-title">Lookup (Left Outer Join)</p>
                    <pre><code class="language-javascript">
db.orders.aggregate([
  { $lookup: {
    from: "customers",
    localField: "customerId",
    foreignField: "_id",
    as: "customerInfo"
  }},
  { $unwind: "$customerInfo" },
  { $project: {
    orderTotal: 1,
    customerName: "$customerInfo.name",
    customerEmail: "$customerInfo.email",
    orderDate: 1
  }},
  { $match: { orderTotal: { $gte: 100 } } }
])
                    </code></pre>
                </section>

                <section>
                    <h3>Faceted Search</h3>
                    <p class="code-title">Multi-Dimensional Analysis</p>
                    <pre><code class="language-javascript">
db.products.aggregate([
  { $facet: {
    "categoryCounts": [
      { $group: { 
        _id: "$category", 
        count: { $sum: 1 },
        avgPrice: { $avg: "$price" }
      } }
    ],
    "priceRanges": [
      { $bucket: {
        groupBy: "$price",
        boundaries: [0, 100, 500, 1000],
        default: "Other",
        output: { 
          count: { $sum: 1 },
          products: { $push: "$name" }
        }
      }}
    ],
    "ratingDistribution": [
      { $group: {
        _id: { $round: ["$rating", 0] },
        count: { $sum: 1 }
      }},
      { $sort: { _id: 1 } }
    ]
  }}
])
                    </code></pre>
                </section>

                <section>
                    <h3>Aggregation Performance Optimization</h3>
                    <div class="highlight-box">
                        <h4>Pipeline Optimization Strategies</h4>
                        <ul>
                            <li class="fragment">Place <code>$match</code> and <code>$sort</code> early to use indexes</li>
                            <li class="fragment">Use <code>$limit</code> after <code>$sort</code> to reduce processing</li>
                            <li class="fragment">Minimize data before expensive operations like <code>$lookup</code></li>
                            <li class="fragment">Use <code>$project</code> to reduce document size</li>
                        </ul>
                    </div>
                    <p class="code-title">Optimized Pipeline Structure</p>
                    <pre><code class="language-javascript">
db.orders.aggregate([
  { $match: { status: "active" } },     // Use index, filter early
  { $sort: { createdAt: -1 } },         // Use index if available
  { $limit: 100 },                      // Limit early
  { $project: { 
    customerId: 1, 
    total: 1, 
    items: 1 
  }},                                   // Reduce document size
  { $lookup: { /* ... */ } }            // Expensive operations later
], { hint: { status: 1, createdAt: -1 } })
                    </code></pre>
                </section>

                <section>
                    <h3>Window Functions</h3>
                    <p class="code-title">Advanced Analytics with $setWindowFields</p>
                    <pre><code class="language-javascript">
// Calculate running totals and moving averages
db.sales.aggregate([
  { $sort: { date: 1 } },
  { $setWindowFields: {
    partitionBy: "$salesPerson",
    sortBy: { date: 1 },
    output: {
      runningTotal: {
        $sum: "$amount",
        window: {
          documents: ["unbounded", "current"]
        }
      },
      movingAverage: {
        $avg: "$amount",
        window: {
          documents: [-2, "current"]  // 3-day moving average
        }
      },
      rank: {
        $rank: {}
      }
    }
  }}
])
                    </code></pre>
                </section>
            </section>

            <!-- Section 4: Performance Optimization -->
            <section>
                <section class="section-title">
                    <h2>4. Performance Optimization</h2>
                </section>

                <section>
                    <h3>Query Performance Tuning</h3>
                    <p class="code-title">Profiling and Monitoring</p>
                    <pre><code class="language-javascript">
// Enable profiler for slow operations
db.setProfilingLevel(2, { slowms: 100 })

// View profiler data
db.system.profile.find().limit(5).sort({ ts: -1 }).pretty()

// Specific profiler queries
db.system.profile.find({
  "command.find": { $exists: true },
  "millis": { $gt: 100 }
})

// Database statistics
db.stats()
db.collection.stats()

// Real-time operations
db.currentOp()
</code></pre>
                </section>

                <section>
                    <h3>Connection and Read Preferences</h3>
                    <div class="two-column">
                        <div>
                            <p class="code-title">Read Preferences</p>
                            <pre><code class="language-javascript small-text">
// Read from secondary replicas
db.users.find().readPref("secondary")

// Prefer secondary, fallback to primary
db.users.find().readPref("secondaryPreferred")

// Read from nearest node
db.users.find().readPref("nearest")

// Read with tags
db.users.find().readPref("secondary", [
  { "datacenter": "east" }
])
                            </code></pre>
                        </div>
                        <div>
                            <p class="code-title">Read Concerns</p>
                            <pre><code class="language-javascript small-text">
// Read concern levels
db.users.find().readConcern("local")
db.users.find().readConcern("majority")
db.users.find().readConcern("linearizable")

// Read concern with transactions
session.startTransaction({
  readConcern: { level: "majority" },
  writeConcern: { w: "majority" }
})
                            </code></pre>
                        </div>
                    </div>
                </section>

                <section>
                    <h3>Memory and Storage Optimization</h3>
                    <div class="highlight-box">
                        <h4>Working Set Management</h4>
                        <ul>
                            <li class="fragment">Keep frequently accessed data in memory</li>
                            <li class="fragment">Monitor memory usage with <code>db.serverStatus().mem</code></li>
                            <li class="fragment">Use projections to reduce data transfer</li>
                            <li class="fragment">Implement data archiving strategies</li>
                        </ul>
                    </div>
                    <p class="code-title">Efficient Query Patterns</p>
                    <pre><code class="language-javascript">
// Efficient projection - only return needed fields
db.users.find(
  { status: "active" },
  { name: 1, email: 1, lastLogin: 1, _id: 0 }
)

// Avoid large documents in memory
db.posts.find({ category: "tech" }).limit(50)

// Use covered queries (index-only)
db.users.find(
  { status: "active" },
  { email: 1, _id: 0 }  // Both fields in index
)
                    </code></pre>
                </section>

                <section>
                    <h3>Connection Pool Optimization</h3>
                    <p class="code-title">Driver Configuration</p>
                    <pre><code class="language-javascript">
// MongoDB driver connection pool settings
const client = new MongoClient(uri, {
  maxPoolSize: 10,              // Maximum connections
  minPoolSize: 2,               // Minimum connections
  maxIdleTimeMS: 30000,         // Close after 30s idle
  serverSelectionTimeoutMS: 5000, // Server selection timeout
  socketTimeoutMS: 45000,       // Socket timeout
  retryWrites: true,            // Retry writes
  retryReads: true,             // Retry reads
  compressors: ['zlib'],        // Compression
  zlibCompressionLevel: 6       // Compression level
})

// Monitor connection pool
db.runCommand({ "serverStatus": 1 }).connections
                    </code></pre>
                </section>
            </section>

            <!-- Section 5: Data Modeling -->
            <section>
                <section class="section-title">
                    <h2>5. Data Modeling Best Practices</h2>
                </section>

                <section>
                    <h3>Embedding vs Referencing Strategies</h3>
                    <div class="two-column">
                        <div>
                            <div class="highlight-box">
                                <h4>‚úÖ Use Embedding When:</h4>
                                <ul>
                                    <li class="fragment">Data accessed together</li>
                                    <li class="fragment">1:1 or 1:few relationships</li>
                                    <li class="fragment">Data doesn't change often</li>
                                    <li class="fragment">Limited, bounded growth</li>
                                    <li class="fragment">Atomic updates needed</li>
                                </ul>
                            </div>
                        </div>
                        <div>
                            <div class="warning-box">
                                <h4>‚ö†Ô∏è Use Referencing When:</h4>
                                <ul>
                                    <li class="fragment">Data accessed independently</li>
                                    <li class="fragment">Many:many relationships</li>
                                    <li class="fragment">Frequently changing data</li>
                                    <li class="fragment">Unbounded growth</li>
                                    <li class="fragment">Need to query referenced data separately</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </section>

                <section>
                    <h3>Embedding Example: User Profile</h3>
                    <p class="code-title">One-to-Few Relationship</p>
                    <pre><code class="language-javascript">
// User with addresses (bounded, accessed together)
{
  _id: ObjectId("..."),
  name: "John Doe",
  email: "john@example.com",
  addresses: [
    {
      type: "home",
      street: "123 Main St",
      city: "New York",
      zipCode: "10001"
    },
    {
      type: "work", 
      street: "456 Business Ave",
      city: "New York",
      zipCode: "10002"
    }
  ],
  preferences: {
    theme: "dark",
    notifications: {
      email: true,
      sms: false,
      push: true
    }
  }
}
                    </code></pre>
                </section>

                <section>
                    <h3>Referencing Example: Blog System</h3>
                    <div class="two-column">
                        <div>
                            <p class="code-title">Posts Collection</p>
                            <pre><code class="language-javascript small-text">
// Posts collection
{
  _id: ObjectId("..."),
  title: "MongoDB Best Practices",
  content: "...",
  authorId: ObjectId("..."),
  tags: ["mongodb", "database"],
  publishDate: ISODate("..."),
  viewCount: 1523,
  commentCount: 45
}
                            </code></pre>
                        </div>
                        <div>
                            <p class="code-title">Comments Collection</p>
                            <pre><code class="language-javascript small-text">
// Comments collection
{
  _id: ObjectId("..."),
  postId: ObjectId("..."),
  author: "Jane Smith",
  content: "Great article!",
  createdAt: ISODate("..."),
  likes: 12,
  replies: [
    {
      author: "Bob Wilson",
      content: "I agree!",
      createdAt: ISODate("...")
    }
  ]
}
                            </code></pre>
                        </div>
                    </div>
                </section>

                <section>
                    <h3>Hybrid Approach: Extended Reference</h3>
                    <p class="code-title">Denormalization for Performance</p>
                    <pre><code class="language-javascript">
// Product with recent reviews embedded, older ones referenced
{
  _id: ObjectId("..."),
  name: "Laptop",
  price: 999,
  category: "Electronics",
  
  // Embed recent/important reviews for quick access
  recentReviews: [
    { 
      author: "User1", 
      rating: 5, 
      text: "Excellent!", 
      date: ISODate("2024-01-15"),
      helpful: 23 
    },
    { 
      author: "User2", 
      rating: 4, 
      text: "Good value", 
      date: ISODate("2024-01-10"),
      helpful: 12 
    }
  ],
  
  // Summary for quick display
  reviewSummary: {
    average: 4.2,
    count: 157,
    distribution: { "5": 78, "4": 45, "3": 23, "2": 8, "1": 3 },
    lastUpdated: ISODate("...")
  }
}
                    </code></pre>
                </section>

                <section>
                    <h3>Advanced Schema Patterns</h3>
                    <div class="two-column">
                        <div>
                            <div class="info-box">
                                <h4>üìä Bucket Pattern</h4>
                                <pre><code class="language-javascript small-text">
// Time-series data bucketing
{
  _id: ObjectId("..."),
  sensor_id: "sensor_001",
  timestamp: ISODate("2024-01-01T00:00:00Z"),
  measurements: [
    { 
      time: ISODate("2024-01-01T00:00:00Z"), 
      temp: 20.1, 
      humidity: 45 
    },
    { 
      time: ISODate("2024-01-01T00:01:00Z"), 
      temp: 20.3, 
      humidity: 46 
    }
    // ... more measurements
  ],
  count: 60,
  min_temp: 19.8,
  max_temp: 21.2
}
                                </code></pre>
                            </div>
                        </div>
                        <div>
                            <div class="info-box">
                                <h4>üé≠ Polymorphic Pattern</h4>
                                <pre><code class="language-javascript small-text">
// Different product types in same collection
{
  _id: ObjectId("..."),
  name: "Product Name",
  type: "book",
  price: 29.99,
  // Book-specific fields
  author: "John Author",
  isbn: "978-...",
  pages: 300,
  publisher: "Tech Books"
}

{
  _id: ObjectId("..."),
  name: "Product Name", 
  type: "electronics",
  price: 199.99,
  // Electronics-specific fields
  brand: "TechCorp",
  warranty: "2 years",
  specs: {
    cpu: "Intel i5",
    ram: "8GB"
  }
}
                                </code></pre>
                            </div>
                        </div>
                    </div>
                </section>
            </section>

            <!-- Section 6: Security & Administration -->
            <section>
                <section class="section-title">
                    <h2>6. Security & Administration</h2>
                </section>

                <section>
                    <h3>Authentication and Authorization</h3>
                    <p class="code-title">User Management</p>
                    <pre><code class="language-javascript">
// Create admin user
use admin
db.createUser({
  user: "admin",
  pwd: "securePassword",
  roles: ["root"]
})

// Create application user with limited permissions
use myapp
db.createUser({
  user: "appUser",
  pwd: "appPassword",
  roles: [
    { role: "readWrite", db: "myapp" },
    { role: "read", db: "analytics" }
  ]
})

// Create custom role
db.createRole({
  role: "productManager",
  privileges: [
    { resource: { db: "store", collection: "products" }, actions: ["find", "update"] },
    { resource: { db: "store", collection: "categories" }, actions: ["find"] }
  ],
  roles: []
})
                    </code></pre>
                </section>

                <section>
                    <h3>Field-Level Security</h3>
                    <p class="code-title">Views for Data Access Control</p>
                    <pre><code class="language-javascript">
// Create view to hide sensitive fields
db.createView("publicUserData", "users", [
  { $project: { 
    name: 1, 
    email: 1, 
    createdAt: 1,
    profile: {
      bio: "$profile.bio",
      avatar: "$profile.avatar"
      // Exclude sensitive profile fields
    },
    // Exclude password, SSN, private data
    _id: 0 
  }}
])

// Create aggregation view with computed fields
db.createView("userStats", "users", [
  { $group: {
    _id: "$department",
    totalUsers: { $sum: 1 },
    avgAge: { $avg: "$age" },
    activeUsers: { 
      $sum: { $cond: [{ $eq: ["$status", "active"] }, 1, 0] } 
    }
  }}
])
                    </code></pre>
                </section>

                <section>
                    <h3>Backup and Recovery Strategies</h3>
                    <div class="two-column">
                        <div>
                            <p class="code-title">MongoDB Tools</p>
                            <pre><code class="language-bash small-text">
# Full backup with mongodump
mongodump --host localhost:27017 \
  --db myapp \
  --out /backup/

# Point-in-time backup with oplog
mongodump --host replica-set/host1:27017 \
  --oplog

# Compressed backup
mongodump --host localhost:27017 \
  --db myapp \
  --gzip \
  --out /backup/

# Selective collection backup
mongodump --host localhost:27017 \
  --db myapp \
  --collection users
                            </code></pre>
                        </div>
                        <div>
                            <p class="code-title">Restore Operations</p>
                            <pre><code class="language-bash small-text">
# Restore from backup
mongorestore --host localhost:27017 \
  --db myapp \
  /backup/myapp/

# Restore with oplog replay
mongorestore --host localhost:27017 \
  --oplogReplay

# Restore to different database
mongorestore --host localhost:27017 \
  --db newapp \
  /backup/myapp/

# Restore specific collection
mongorestore --host localhost:27017 \
  --db myapp \
  --collection users \
  /backup/myapp/users.bson
                            </code></pre>
                        </div>
                    </div>
                </section>
            </section>

            <!-- Section 7: Practical Exercises -->
            <section>
                <section class="section-title">
                    <h2>7. Practical Exercises</h2>
                </section>

                <section class="lab-slide">
                    <h3>üß™ Exercise 1: Query Optimization Challenge</h3>
                    
                    <div class="exercise-box">
                        <h4>Scenario: E-commerce Order Analysis</h4>
                        <p><strong>Task:</strong> Find top 10 customers by order value, optimize the query and create appropriate indexes</p>
                    </div>

                    <p class="code-title">Solution Approach</p>
                    <pre><code class="language-javascript">
// 1. Create compound index
db.orders.createIndex({ 
  customerId: 1, 
  orderDate: 1, 
  totalAmount: -1 
})

// 2. Optimized aggregation pipeline
db.orders.aggregate([
  { $match: { 
    orderDate: { 
      $gte: ISODate("2024-01-01"), 
      $lt: ISODate("2025-01-01") 
    } 
  }},
  { $group: {
    _id: "$customerId",
    totalSpent: { $sum: "$totalAmount" },
    orderCount: { $sum: 1 },
    avgOrderValue: { $avg: "$totalAmount" }
  }},
  { $sort: { totalSpent: -1 } },
  { $limit: 10 }
])
                    </code></pre>
                </section>

                <section class="lab-slide">
                    <h3>üß™ Exercise 2: Schema Design Challenge</h3>
                    
                    <div class="exercise-box">
                        <h4>Social Media Platform Design</h4>
                        <p><strong>Design a schema for:</strong></p>
                        <ul>
                            <li>Users with profiles and settings</li>
                            <li>Posts with comments and likes</li>
                            <li>Following/follower relationships</li>
                            <li>Real-time notifications</li>
                        </ul>
                    </div>

                    <div class="objectives">
                        <h4>Consider:</h4>
                        <ul>
                            <li>Read vs write patterns</li>
                            <li>Data growth expectations</li>
                            <li>Query requirements</li>
                            <li>Performance constraints</li>
                        </ul>
                    </div>
                </section>

                <section class="lab-slide">
                    <h3>üß™ Exercise 3: Performance Tuning Lab</h3>
                    
                    <div class="exercise-box">
                        <h4>Real-World Performance Issues</h4>
                        <p><strong>Scenario:</strong> Slow aggregation pipeline on large dataset</p>
                    </div>

                    <p class="code-title">Performance Analysis Steps</p>
                    <pre><code class="language-javascript">
// 1. Analyze current performance
db.collection.aggregate([...pipeline], { explain: true })

// 2. Enable profiling
db.setProfilingLevel(2, { slowms: 50 })

// 3. Identify bottlenecks
db.system.profile.find({ 
  "command.aggregate": "collection",
  "millis": { $gt: 100 }
}).sort({ ts: -1 })

// 4. Optimize pipeline order
// 5. Add appropriate indexes
// 6. Use $limit early
// 7. Minimize document size with $project
                    </code></pre>
                </section>

                <section class="lab-slide">
                    <h3>üß™ Exercise 4: Advanced Aggregation Workshop</h3>
                    
                    <div class="exercise-box">
                        <h4>Business Intelligence Dashboard</h4>
                        <p><strong>Create aggregation pipelines for:</strong></p>
                        <ul>
                            <li>Monthly sales trends</li>
                            <li>Customer segmentation analysis</li>
                            <li>Product performance metrics</li>
                            <li>Regional sales comparison</li>
                        </ul>
                    </div>

                    <div class="highlight-box">
                        <h4>Advanced Techniques to Use</h4>
                        <ul>
                            <li>$facet for multiple analytics</li>
                            <li>$bucket for data grouping</li>
                            <li>$lookup for data enrichment</li>
                            <li>$setWindowFields for trends</li>
                        </ul>
                    </div>
                </section>
            </section>

            <!-- Section 8: Troubleshooting -->
            <section>
                <section class="section-title">
                    <h2>8. Troubleshooting Common Issues</h2>
                </section>

                <section>
                    <h3>Performance Problems Diagnosis</h3>
                    <div class="two-column">
                        <div>
                            <div class="warning-box">
                                <h4>üêå Slow Queries</h4>
                                <ul>
                                    <li class="fragment">Check for missing indexes</li>
                                    <li class="fragment">Analyze query patterns in profiler</li>
                                    <li class="fragment">Consider compound indexes</li>
                                    <li class="fragment">Use projections to limit data</li>
                                    <li class="fragment">Avoid regex on large collections</li>
                                </ul>
                            </div>
                        </div>
                        <div>
                            <div class="warning-box">
                                <h4>üíæ Memory Issues</h4>
                                <ul>
                                    <li class="fragment">Monitor working set size</li>
                                    <li class="fragment">Implement appropriate indexes</li>
                                    <li class="fragment">Use aggregation efficiently</li>
                                    <li class="fragment">Consider data archiving</li>
                                    <li class="fragment">Limit result set sizes</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </section>

                <section>
                    <h3>Connection and Replication Issues</h3>
                    <p class="code-title">Common Diagnostics</p>
                    <pre><code class="language-javascript">
// Check connection status
db.runCommand({ "serverStatus": 1 }).connections

// Monitor replication lag
rs.printReplicationInfo()
rs.printSlaveReplicationInfo()

// Check replica set status
rs.status()

// Monitor oplog size
db.oplog.rs.stats()

// Check for connection pool exhaustion
db.runCommand({ "connPoolStats": 1 })

// Monitor current operations
db.currentOp({ "active": true })

// Kill long-running operations
db.killOp(opid)
                    </code></pre>
                </section>

                <section>
                    <h3>Index and Query Issues</h3>
                    <p class="code-title">Debugging Slow Queries</p>
                    <pre><code class="language-javascript">
// Detailed query analysis
db.collection.find({ query }).explain("allPlansExecution")

// Check index usage
db.collection.aggregate([{ $indexStats: {} }])

// Find queries not using indexes
db.system.profile.find({
  "planSummary": { $regex: /COLLSCAN/ }
})

// Monitor index building
db.currentOp({
  $or: [
    { "command.createIndexes": { $exists: true } },
    { "msg": /index/i }
  ]
})

// Check for lock contention
db.currentOp({ "waitingForLock": true })
                    </code></pre>
                </section>
            </section>

            <!-- Key Takeaways -->
            <section>
                <section class="section-title">
                    <h2>Key Takeaways & Best Practices</h2>
                </section>

                <section>
                    <h3>Performance Optimization Summary</h3>
                    <div class="highlight-box">
                        <h4>üöÄ Essential Performance Principles</h4>
                        <ol>
                            <li class="fragment"><strong>Index Strategy:</strong> Follow ESR rule, create compound indexes for common queries</li>
                            <li class="fragment"><strong>Query Optimization:</strong> Use projections, limit results, leverage aggregation framework</li>
                            <li class="fragment"><strong>Schema Design:</strong> Model data based on access patterns, not normalization</li>
                            <li class="fragment"><strong>Monitoring:</strong> Enable profiling, use explain(), monitor performance metrics</li>
                            <li class="fragment"><strong>Resource Management:</strong> Optimize connection pools, manage memory usage</li>
                        </ol>
                    </div>
                </section>

                <section>
                    <h3>Data Modeling Best Practices</h3>
                    <div class="two-column">
                        <div>
                            <div class="info-box">
                                <h4>‚úÖ Do's</h4>
                                <ul>
                                    <li class="fragment">Design for your application's queries</li>
                                    <li class="fragment">Embed related data accessed together</li>
                                    <li class="fragment">Use references for independent data</li>
                                    <li class="fragment">Implement appropriate indexes</li>
                                    <li class="fragment">Consider data growth patterns</li>
                                    <li class="fragment">Use schema validation</li>
                                </ul>
                            </div>
                        </div>
                        <div>
                            <div class="warning-box">
                                <h4>‚ùå Don'ts</h4>
                                <ul>
                                    <li class="fragment">Over-normalize like relational databases</li>
                                    <li class="fragment">Create documents near 16MB limit</li>
                                    <li class="fragment">Allow unbounded array growth</li>
                                    <li class="fragment">Ignore index selectivity</li>
                                    <li class="fragment">Use inefficient aggregation patterns</li>
                                    <li class="fragment">Skip performance testing</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </section>

                <section>
                    <h3>Production Readiness Checklist</h3>
                    <div class="info-box">
                        <h4>üîß Essential Production Setup</h4>
                        <ul>
                            <li class="fragment"><strong>Security:</strong> Authentication enabled, network security configured</li>
                            <li class="fragment"><strong>Monitoring:</strong> Performance metrics, alerting, log analysis</li>
                            <li class="fragment"><strong>Backup:</strong> Automated backups, tested restore procedures</li>
                            <li class="fragment"><strong>Scaling:</strong> Replica sets for HA, sharding for horizontal scale</li>
                            <li class="fragment"><strong>Performance:</strong> Optimized queries, appropriate indexes</li>
                            <li class="fragment"><strong>Maintenance:</strong> Update procedures, capacity planning</li>
                        </ul>
                    </div>
                </section>
            </section>

            <!-- Summary and Next Steps -->
            <section>
                <section class="section-title">
                    <h2>Day 3 Summary & Next Steps</h2>
                </section>

                <section>
                    <h3>What We've Accomplished</h3>
                    <div class="highlight-box">
                        <ol>
                            <li class="fragment"><strong>Advanced Querying:</strong> Complex operators, text search, geospatial queries</li>
                            <li class="fragment"><strong>Index Mastery:</strong> Compound indexes, ESR rule, performance analysis</li>
                            <li class="fragment"><strong>Aggregation Framework:</strong> Complex pipelines, optimization techniques</li>
                            <li class="fragment"><strong>Performance Tuning:</strong> Profiling, monitoring, optimization strategies</li>
                            <li class="fragment"><strong>Schema Patterns:</strong> Advanced modeling techniques and patterns</li>
                            <li class="fragment"><strong>Security & Admin:</strong> User management, backup strategies</li>
                            <li class="fragment"><strong>Troubleshooting:</strong> Common issues and solutions</li>
                        </ol>
                    </div>
                </section>

                <section>
                    <h3>Recommended Practice</h3>
                    <div class="exercise-box">
                        <h4>üìù Post-Day 3 Activities</h4>
                        <ol>
                            <li class="fragment">Analyze your current application's query patterns</li>
                            <li class="fragment">Profile and optimize existing slow queries</li>
                            <li class="fragment">Review and refactor current schema designs</li>
                            <li class="fragment">Implement monitoring for your MongoDB instances</li>
                            <li class="fragment">Practice aggregation pipelines with real data</li>
                            <li class="fragment">Set up backup and recovery procedures</li>
                        </ol>
                    </div>
                </section>

                <section>
                    <h3>Additional Resources</h3>
                    <div class="two-column">
                        <div>
                            <div class="info-box">
                                <h4>üìö Documentation</h4>
                                <ul>
                                    <li><strong>Performance Best Practices</strong></li>
                                    <li><strong>Aggregation Pipeline Optimization</strong></li>
                                    <li><strong>Index Strategies Guide</strong></li>
                                    <li><strong>Schema Design Patterns</strong></li>
                                </ul>
                            </div>
                        </div>
                        <div>
                            <div class="info-box">
                                <h4>üõ†Ô∏è Tools & Monitoring</h4>
                                <ul>
                                    <li><strong>MongoDB Compass</strong> - Visual analysis</li>
                                    <li><strong>MongoDB Atlas</strong> - Cloud monitoring</li>
                                    <li><strong>Profiler</strong> - Query analysis</li>
                                    <li><strong>Explain Plans</strong> - Performance insights</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="title-slide">
                    <h1>Excellent Progress!</h1>
                    <h2>MongoDB Day 3 Complete</h2>
                    <p style="margin-top: 2em;">
                        üéØ Advanced operations mastered!<br>
                        ‚ö° Performance optimization achieved<br>
                        üçÉ Production-ready MongoDB skills developed
                    </p>
                    <div style="margin-top: 2em;">
                        <p><strong>You're now equipped with advanced MongoDB expertise!</strong></p>
                    </div>
                </section>
            </section>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/reveal.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/plugin/notes/notes.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/plugin/markdown/markdown.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/plugin/highlight/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/plugin/search/search.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/plugin/zoom/zoom.min.js"></script>

    <script>
        Reveal.initialize({
            hash: true,
            controls: true,
            progress: true,
            center: true,
            transition: 'slide',
            transitionSpeed: 'default',
            backgroundTransition: 'fade',
            
            plugins: [ RevealMarkdown, RevealHighlight, RevealNotes, RevealSearch, RevealZoom ],
            
            width: 1200,
            height: 800,
            margin: 0.1,
            minScale: 0.2,
            maxScale: 1.5,
            
            keyboard: {
                13: 'next',
                27: function() {
                    if (Reveal.isOverview()) {
                        Reveal.toggleOverview();
                    }
                }
            },
            
            touch: true,
            loop: false,
            rtl: false,
            fragments: true,
            fragmentInURL: true,
            autoSlide: 0,
            autoSlideStoppable: true,
            mouseWheel: false,
            rollingLinks: false,
            hideAddressBar: true,
            
            highlight: {
                highlightOnLoad: true
            }
        });

        Reveal.addKeyBinding({keyCode: 79, key: 'O', description: 'Toggle overview'}, function() {
            Reveal.toggleOverview();
        });

        if (window.location.search.match(/print-pdf/gi)) {
            var link = document.createElement('link');
            link.rel = 'stylesheet';
            link.type = 'text/css';
            link.href = 'https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/css/print/pdf.min.css';
            document.getElementsByTagName('head')[0].appendChild(link);
        }

        Reveal.configure({
            slideNumber: 'c/t',
            showSlideNumber: 'all'
        });
    </script>
</body>
</html>